<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Phantom Type | Scala Tour</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="dcapwell">
        <meta name="description" content="My location for adding scala findings">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./Structural Types.html" />
        
        
        <link rel="prev" href="./Path Dependent Types.html" />
        

        <meta property="og:title" content="Phantom Type | Scala Tour">
        <meta property="og:site_name" content="Scala Tour">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/dcapwell">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

        
        <link rel="stylesheet" href="gitbook/style.css">
        
        
    </head>
    <body>
        
<div class="book" data-github="dcapwell/scala-tour" data-level="2.7">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/dcapwell/scala-tour" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/dcapwell/scala-tour/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/dcapwell/scala-tour/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="./README.html" >Scala Tour</a></h1>
</div>

    <div class="book-summary">
    <ul class="summary">
        <li>
            <a href="https://github.com/dcapwell" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/dcapwell/scala-tour/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/dcapwell/scala-tour/edit/master/Phantom Type.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0">
            <a href="./README.html"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1">
                
                <a href="./Language.html">
                    <i class="fa fa-check"></i> <b>1)</b> Language
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1">
                            
                            <a href="./Partial Function.html">
                                <i class="fa fa-check"></i> <b>1.1)</b> Partial Function
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2">
                
                <a href="./Types.html">
                    <i class="fa fa-check"></i> <b>2)</b> Types
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1">
                            
                            <a href="./Variance.html">
                                <i class="fa fa-check"></i> <b>2.1)</b> Variance
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2">
                            
                            <a href="./Value Classes.html">
                                <i class="fa fa-check"></i> <b>2.2)</b> Value Classes
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3">
                            
                            <a href="./F-Bounded Type.html">
                                <i class="fa fa-check"></i> <b>2.3)</b> F-Bounded Type
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4">
                            
                            <a href="./Type Classes.html">
                                <i class="fa fa-check"></i> <b>2.4)</b> Type Classes
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5">
                            
                            <a href="./Higher Kind.html">
                                <i class="fa fa-check"></i> <b>2.5)</b> Higher Kind
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.6">
                            
                            <a href="./Path Dependent Types.html">
                                <i class="fa fa-check"></i> <b>2.6)</b> Path Dependent Types
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.7">
                            
                            <a href="./Phantom Type.html">
                                <i class="fa fa-check"></i> <b>2.7)</b> Phantom Type
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.8">
                            
                            <a href="./Structural Types.html">
                                <i class="fa fa-check"></i> <b>2.8)</b> Structural Types
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.9">
                            
                            <a href="./Union and Intersection types.html">
                                <i class="fa fa-check"></i> <b>2.9)</b> Union and Intersection types
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3">
                
                <a href="./Patterns.html">
                    <i class="fa fa-check"></i> <b>3)</b> Patterns
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1">
                            
                            <a href="./Cake.html">
                                <i class="fa fa-check"></i> <b>3.1)</b> Cake
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4">
                
                <a href="./Scalaz.html">
                    <i class="fa fa-check"></i> <b>4)</b> Scalaz
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1">
                            
                            <a href="./Utils.html">
                                <i class="fa fa-check"></i> <b>4.1)</b> Utils
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2">
                            
                            <a href="./Tag Types.html">
                                <i class="fa fa-check"></i> <b>4.2)</b> Tag Types
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.3">
                            
                            <a href="./Memoization.html">
                                <i class="fa fa-check"></i> <b>4.3)</b> Memoization
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5">
                
                <a href="./References.html">
                    <i class="fa fa-check"></i> <b>5)</b> References
                </a>
                
                
            </li>
        
    </ul>
</div>

    <div class="book-body" tabindex="-1">
        <div class="page-wrapper">
            <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 52.63157894736842%;min-width: 47.36842105263158%;"></div>
    </div>
    <div class="chapters">
    
        <a href="./README.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="./Language.html" title="Language" class="chapter done new-chapter" data-progress="1" style="left: 5.2631578947368425%;"></a>
    
        <a href="./Partial Function.html" title="Partial Function" class="chapter done " data-progress="1.1" style="left: 10.526315789473685%;"></a>
    
        <a href="./Types.html" title="Types" class="chapter done new-chapter" data-progress="2" style="left: 15.789473684210526%;"></a>
    
        <a href="./Variance.html" title="Variance" class="chapter done " data-progress="2.1" style="left: 21.05263157894737%;"></a>
    
        <a href="./Value Classes.html" title="Value Classes" class="chapter done " data-progress="2.2" style="left: 26.31578947368421%;"></a>
    
        <a href="./F-Bounded Type.html" title="F-Bounded Type" class="chapter done " data-progress="2.3" style="left: 31.57894736842105%;"></a>
    
        <a href="./Type Classes.html" title="Type Classes" class="chapter done " data-progress="2.4" style="left: 36.8421052631579%;"></a>
    
        <a href="./Higher Kind.html" title="Higher Kind" class="chapter done " data-progress="2.5" style="left: 42.10526315789474%;"></a>
    
        <a href="./Path Dependent Types.html" title="Path Dependent Types" class="chapter done " data-progress="2.6" style="left: 47.36842105263158%;"></a>
    
        <a href="./Phantom Type.html" title="Phantom Type" class="chapter done " data-progress="2.7" style="left: 52.63157894736842%;"></a>
    
        <a href="./Structural Types.html" title="Structural Types" class="chapter  " data-progress="2.8" style="left: 57.89473684210526%;"></a>
    
        <a href="./Union and Intersection types.html" title="Union and Intersection types" class="chapter  " data-progress="2.9" style="left: 63.1578947368421%;"></a>
    
        <a href="./Patterns.html" title="Patterns" class="chapter  new-chapter" data-progress="3" style="left: 68.42105263157895%;"></a>
    
        <a href="./Cake.html" title="Cake" class="chapter  " data-progress="3.1" style="left: 73.6842105263158%;"></a>
    
        <a href="./Scalaz.html" title="Scalaz" class="chapter  new-chapter" data-progress="4" style="left: 78.94736842105263%;"></a>
    
        <a href="./Utils.html" title="Utils" class="chapter  " data-progress="4.1" style="left: 84.21052631578948%;"></a>
    
        <a href="./Tag Types.html" title="Tag Types" class="chapter  " data-progress="4.2" style="left: 89.47368421052632%;"></a>
    
        <a href="./Memoization.html" title="Memoization" class="chapter  " data-progress="4.3" style="left: 94.73684210526316%;"></a>
    
        <a href="./References.html" title="References" class="chapter  new-chapter" data-progress="5" style="left: 100%;"></a>
    
    </div>
</div>

            <div class="page-inner">
            
                <section class="normal" id="section-gitbook_9">
                
                    <h1 id="phantom-type">Phantom Type</h1>
<p>Have you ever worked with objects that could be in different states: open/closed, started/stopped, etc?  How many times have you forgot to check what state the object was in before working with it (I have tried to write to sockets that where closed way too many times)?  Ever wondered if you could move these checks into something that gets enforced other than wrapping it around a monad?  Thats where phantom types come in.</p>
<p>A phantom type is a type that is not instantiate ever.  Instead of an object using the type directly, the type is used to enforce some logic.  Lets look at file handles to help explain this.</p>
<pre><code class="lang-scala"><span class="hljs-keyword">val</span> fh = open(<span class="hljs-string">"/tmp/foo.txt"</span>)
...
fh.close
...
fh.write(<span class="hljs-string">"please be open"</span>) <span class="hljs-comment">// may fail some times cause fh has been closed.</span>
</code></pre>
<p>Lets make writing to files type safe in regards to closed state.</p>
<pre><code class="lang-scala">sealed trait FileState
final class Opened extends FileState
final class Closed extends FileState

trait FileHandle[State &lt;: FileState] {
    def write[T &gt;: State &lt;: Opened](line: String): Unit
    def close: FileHandle[Closed]
}
</code></pre>
<p>Here we define a <code>FileState</code> that can be either <code>Opened</code> or <code>Closed</code>.  We have marked each method with the type that it can work with: <code>write</code> only works if the <code>FileHandle</code> is opened, <code>close</code> will mark the <code>FileHandle</code> as <code>Closed</code>.</p>
<p>Lets see what happens when we try to <code>write</code> to a <code>Closed</code> file.</p>
<pre><code class="lang-scala">// open a filehandle
def open(path: String): FileHandle[Opened] = new FileHandle[Opened] {
    def write[Opened](line: String): Unit = println(line)
    def close: FileHandle[Closed] = this.asInstanceOf[FileHandle[Closed]]
}

val fh = open("/tmp/foo.txt")
fh.write("bar")

val fh2 = fh.close
fh2.write("rejected son!")
&lt;console&gt;:41: error: inferred type arguments [Closed] do not conform to method write's type parameter bounds [T &gt;: Closed &lt;: Opened]
              fh2.write("rejected son!")
                  ^
</code></pre>
<p>As we see here, the compiler will reject writing to files that are already closed!  But could the user try to break this?</p>
<pre><code class="lang-scala">scala&gt; <span class="hljs-keyword">val</span> fh3: FileHandle[FileState] = fh.close
&lt;console&gt;:<span class="hljs-number">39</span>: error: <span class="hljs-keyword">type</span> mismatch;
 found   : FileHandle[Closed]
 required: FileHandle[FileState]
Note: Closed &lt;: FileState, but <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">FileHandle</span> <span class="hljs-title">is</span> <span class="hljs-title">invariant</span> <span class="hljs-title">in</span> <span class="hljs-title">type</span> <span class="hljs-title">State</span>.</span>
You may wish to define State as +State instead. (SLS <span class="hljs-number">4.5</span>)
       <span class="hljs-keyword">val</span> fh3: FileHandle[FileState] = fh.close
                                           ^
</code></pre>
<p>Even if we could get from <code>Closed</code> to <code>FileState</code> we wouldn&#39;t be able to get to <code>Openeded</code>, so writing will still not be possible.</p>

                
                </section>
            
            </div>

            <div class="page-footer">
    
        
            
            <a href="./Structural Types.html" class="navigation-link next">Next</a>
            
        
    
</div>
        </div>
    </div>
</div>

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
        
    </body>
</html>
